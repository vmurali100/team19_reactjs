<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <form action="">
      <label for="">ID</label>
      <input type="text" name="" id="id" /><br />
      <label for="">fname</label>
      <input type="text" id="fname" /> <br />

      <label for="">lname</label>
      <input type="text" id="lname" /><br />

      <label for="">gender</label>
      <input type="radio" name="gender" value="male" />male
      <input type="radio" name="gender" value="female" />female <br /><br />

      <label for="">subjects</label>
      <input type="checkbox" name="subjects" value="html" />HTML
      <input type="checkbox" name="subjects" value="css" />CSS <br /><br />

      <button type="button" onclick="updateuser()">updateuser</button>
    </form>
 
    <script>
      var userToEdit = JSON.parse(localStorage.getItem("userToEdit"));
      console.log("In edit user page", userToEdit);

      for (a in userToEdit) {
        if (a !== "gender" && a !== "subjects") {
          document.getElementById(a).value = userToEdit[a];
        } else if (a == "gender") {
          var allradiobtns = document.getElementsByName("gender");
          for (let index = 0; index < allradiobtns.length; index++) {
            if (allradiobtns[index].value == userToEdit.gender) {
              allradiobtns[index].checked = true;
            }
          }
        } else if (a == "subjects") {
          var allcheckboxes = document.getElementsByName("subjects");
          for (let index = 0; index < allcheckboxes.length; index++) {
            var check = userToEdit.subjects.some(
              (val) => allcheckboxes[index].value == val
            );
            allcheckboxes[index].checked = check;
          }
        }
      }

      function updateuser() {
        var user = {
        id : document.getElementById("id").value,
          fname: document.getElementById("fname").value,
          lname: document.getElementById("lname").value,
          gender: "",
          subjects: [],
        };

        var allradiobtns = document.getElementsByName("gender");
        for (i = 0; i < allradiobtns.length; i++) {
          if (allradiobtns[i].checked) {
            user.gender = allradiobtns[i].value;
          }
        }

        var allcheckboxes = document.getElementsByName("subjects");
        for (i = 0; i < allcheckboxes.length; i++) {
          if (allcheckboxes[i].checked) {
            user.subjects.push(allcheckboxes[i].value);
          }
        }

        updateusertoAPI(user)
      }

      function updateusertoAPI(user) {
        var updatedata = new XMLHttpRequest();
        updatedata.onreadystatechange = function () {
          if (updatedata.readyState == 4 && updatedata.status == 200) {
          }
        };
        updatedata.open(
          "PUT",
          "http://localhost:3000/users/" + userToEdit.id
        );
        updatedata.setRequestHeader("content-type", "application/json");
        updatedata.send(JSON.stringify(user));
        window.location.href = "BOM1.html"
      }
    </script>
  </body>
</html>
