<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <form action="">
        <label for="fname">fname</label>
        <input type="text" id="fname">

        <label for="lname">lname</label>
        <input type="text" id="lname">

        <label for="">Gender</label>
        <input type="radio" name="gender" value="male">male
        <input type="radio" name="gender" value="female">female
        <input type="radio" name="gender" value="others">others

        <button type="button" onclick="representuser()">submit</button>

        <button type="button" onclick="adduser()">adduser</button>
        <button type="button" onclick="updateuser()">updateuser</button>
    </form>

    <table border="1">
        <thead>
            <tr>
                <th>fname</th>
                <th>lname</th>
                <th>edit</th>
                <th>delete</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        var person=[]
       function adduser(){
        var student={
            fname:document.getElementById("fname").value,
            lname:document.getElementById("lname").value,
            gender:"null",
            subjects:[]
        

       }
       person.push(student)
       clearUser()
       displayUsers()
    }

    
    function displayUsers(){
        document.querySelector("tbody").innerHTML=""

        for(i=0;i<person.length;i++){
            var mytr=document.createElement("tr")

            for( a in person[i]){

                var mytd=document.createElement("td")
                mytd.innerHTML=person[i][a]

                mytr.appendChild(mytd)
                 }
                 var edittd=document.createElement('td')
            var editbtn=document.createElement('button')
            editbtn.innerHTML='edit'

            editbtn.setAttribute("onclick","edituser("+i+")")
            edittd.appendChild(editbtn)
            mytr.appendChild(edittd)


            var deltd=document.createElement("td")
            var delbtn=document.createElement("button")
            delbtn.innerHTML="delete"
            delbtn.setAttribute("onclick","deleteuser("+i+")")

            deltd.appendChild(delbtn)
            mytr.appendChild(deltd)
           
        document.querySelector("tbody").appendChild(mytr)
     }

     }
      var gindex=null;
      function edituser(i){
        gindex=i
        fname:document.getElementById('fname').value=person[i].fname
        lname:document.getElementById("lname").value=person[i].lname

      }
     function updateuser(){
        var student={
            fname:document.getElementById("fname").value,
            lname:document.getElementById("lname").value
        }
        person[gindex]=student
        displayUsers()
        clearUser()
        
     }

    //  function deleteuser(i){
    //     person=person.filter((usr=>{
    //         return usr.fname!==person[i].fname

    //     }))
    //     displayUsers()
    //  }


    // function deleteuser(){
    //     person=person.filter((usr)=>{
    //         return usr.fname!==person[i].fname
    //     })
    //     displayusers()

    // }

    function deleteuser(i){
        person=person.filter((usr)=>{
        return usr.fname!==person[i].fname
        })
        displayUsers()
    }

    function representuser(){
       
        var allRadiobtns=document.getElementsByName("gender")
        for(i=0;i<allRadiobtns.length;i++){
            if(allRadiobtns[i].checked){
                console.log(allRadiobtns[i].value)
                student.gender=allRadiobtns[i].value
            }
            console.log(student)
        }
    }



    function clearUser(){
        fname:document.getElementById("fname").value="";
        lname:document.getElementById("lname").value="";

    }
</script>

<form>
    <label for="">Gender </label> <br>
    <input type="radio" name="gender" value="Male"> Male
    <input type="radio" name="gender" value="Female"> Female
    <input type="radio" name="gender" value="Others"> Others
    <br><br>
    <label for="">Subjects : </label> <br>
    HTML <input type="checkbox" name="subjects" value="HTML"> <br>
    CSS <input type="checkbox" name="subjects" value="CSS"> <br>
    Javascript <input type="checkbox" name="subjects" value="Javascript"> <br>
    ReactJS <input type="checkbox" name="subjects" value="ReactJS"> <br>
    
    <label for="">DOB</label>
    <input type="date" name="" id="dob"> <br>
    
    <label for="">State :</label>
    <select name="" id="stateName">
        <option value="AP">AP</option>
        <option value="TS">TS</option>
        <option value="TN">TN</option>
        <option value="KA">KA</option>
        <option value="MP">MP</option>
    </select> <br> <br>
    <button type="button" onclick="addUser()">Add User</button>
    
    </form>
    
    <script>
    function addUser() {
        var person = {
            fname: "ram",
            lname: "sam",
            gender: "",
            subjects: [],
    
        }
        var allCheckBoxes = document.getElementsByName("subjects");
        for (let index = 0; index < allCheckBoxes.length; index++) {
            if (allCheckBoxes[index].checked === true) {
                person.subjects.push(allCheckBoxes[index].value);
            }
    
        }
    
        var allRadioBtns = document.getElementsByName("gender")
    
        for (let index = 0; index < allRadioBtns.length; index++) {
            if (allRadioBtns[index].checked) {
                person.gender = allRadioBtns[index].value;
            }
    
        }
    
        person.dob = document.getElementById("dob").value
        person.stateName = document.getElementById("stateName").value
        console.log(person)
        postDataToServer(person)
    }
    function postDataToServer(person) {
        var addData = new XMLHttpRequest();
        addData.onreadystatechange = function () {
            if (addData.readyState == 4 && addData.status == 201) {
                console.log("User Added Successfully")
            }
        }
        addData.open("POST", "http://localhost:3000/people");
        addData.setRequestHeader("Content-Type", "Application/json");
        addData.send(JSON.stringify(person))
    }
    
    function getDataFromServer() {
        var getPeople = new XMLHttpRequest();
        getPeople.onreadystatechange = function () {
            if (getPeople.readyState == 4 && getPeople.status == 200) {
                console.log(JSON.parse(getPeople.response))
            }
        }
        getPeople.open("GET","http://localhost:3000/people");
        getPeople.send()
    }
    
    getDataFromServer()
    
    
    var allCheckBoxes=document.getElementsByName("subjects")
    for(i=0;i<allCheckBoxes.length;i++);
    

    </script>

</body>
</html